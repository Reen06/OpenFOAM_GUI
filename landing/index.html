<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>OpenFOAM GUI</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="/static/landing/css/styles.css">
</head>

<body>
    <!-- Running Simulations Container -->
    <div id="simulations-container" class="simulations-container"></div>

    <!-- Ready Message (shown when no simulations running) -->
    <div id="ready-bar" class="ready-bar">
        <span class="ready-icon">‚úÖ</span>
        <span class="ready-text">Ready to run simulations</span>
    </div>

    <div class="container">
        <header class="header">
            <div class="logo">
                <span class="logo-icon">üåä</span>
                <h1>OpenFOAM GUI</h1>
            </div>
            <p class="tagline">Unified interface for CFD simulations</p>
            <div class="header-actions">
                <button id="view-toggle-btn" class="view-toggle-btn" onclick="toggleViewMode()"
                    title="Switch to list view">‚ò∞</button>
                <span class="version">ESI OpenFOAM v2506</span>
            </div>
        </header>

        <main class="tools-grid" id="tools-grid">
            <!-- Case cards will be dynamically rendered here -->
            <div class="loading-state">Loading cases...</div>
        </main>

        <footer class="footer">
            <p>OpenFOAM is a registered trademark of OpenCFD Ltd.</p>
        </footer>
    </div>

    <!-- Import Case Modal -->
    <div id="import-modal" class="modal-overlay" style="display: none;">
        <div class="modal-content">
            <div class="modal-header">
                <h3>üì• Import Case</h3>
                <button class="modal-close" onclick="closeImportModal()">√ó</button>
            </div>
            <div class="modal-body">
                <!-- Upload step -->
                <div id="import-upload-step">
                    <div class="upload-zone" id="upload-zone" onclick="document.getElementById('file-input').click()">
                        <div class="upload-icon">üì¶</div>
                        <p>Click to select or drag & drop a case archive (.zip)</p>
                        <input type="file" id="file-input" accept=".zip" style="display: none;"
                            onchange="handleFileSelect(event)">
                    </div>
                    <div id="upload-status" class="upload-status"></div>
                </div>

                <!-- Options step (shown when runs/meshes detected) -->
                <div id="import-options-step" style="display: none;">
                    <input type="hidden" id="import-staging-id">
                    <p class="export-description">
                        <strong id="import-module-name"></strong> contains saved data. Choose what to import:
                    </p>

                    <div id="import-runs-option" class="checkbox-group" style="display: none;">
                        <label class="checkbox-label">
                            <input type="checkbox" id="import-include-runs" checked>
                            <span class="checkbox-text">Import saved runs</span>
                            <span class="checkbox-hint">Simulation data and results</span>
                        </label>
                    </div>

                    <div id="import-meshes-option" class="checkbox-group" style="display: none;">
                        <label class="checkbox-label">
                            <input type="checkbox" id="import-include-meshes" checked>
                            <span class="checkbox-text">Import mesh library</span>
                            <span class="checkbox-hint">Uploaded and converted meshes</span>
                        </label>
                    </div>

                    <div class="modal-actions">
                        <button class="btn btn-secondary" onclick="cancelImportOptions()">Cancel</button>
                        <button class="btn btn-primary" onclick="completeImport()">üì• Complete Import</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Delete Confirmation Modal -->
    <div id="delete-modal" class="modal-overlay" style="display: none;">
        <div class="modal-content modal-small">
            <div class="modal-header">
                <h3>‚ö†Ô∏è Confirm Delete</h3>
                <button class="modal-close" onclick="closeDeleteModal()">√ó</button>
            </div>
            <div class="modal-body">
                <p id="delete-message">Are you sure you want to delete this case?</p>
                <div class="modal-actions">
                    <button class="btn btn-secondary" onclick="closeDeleteModal()">Cancel</button>
                    <button class="btn btn-danger" id="confirm-delete-btn" onclick="confirmDelete()">Delete</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Case Error Modal -->
    <div id="error-modal" class="modal-overlay" style="display: none;">
        <div class="modal-content">
            <div class="modal-header">
                <h3>‚ùå Case Error</h3>
                <button class="modal-close" onclick="closeErrorModal()">√ó</button>
            </div>
            <div class="modal-body">
                <div class="error-details">
                    <p><strong>Case:</strong> <span id="error-case-name"></span></p>
                    <p><strong>Error:</strong></p>
                    <pre id="error-message"></pre>
                </div>
                <div class="modal-actions">
                    <button class="btn btn-secondary" onclick="closeErrorModal()">Close</button>
                    <button class="btn btn-primary" id="revalidate-btn" onclick="revalidateCase()">üîÑ
                        Re-validate</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Edit Module Modal -->
    <div id="edit-modal" class="modal-overlay" style="display: none;">
        <div class="modal-content">
            <div class="modal-header">
                <h3>‚úèÔ∏è Edit Module</h3>
                <button class="modal-close" onclick="closeEditModal()">√ó</button>
            </div>
            <div class="modal-body">
                <input type="hidden" id="edit-module-id">

                <div class="form-group">
                    <label for="edit-icon">Icon (emoji)</label>
                    <input type="text" id="edit-icon" class="form-input" placeholder="üå¨Ô∏è" maxlength="4">
                </div>

                <div class="form-group">
                    <label for="edit-name">Name</label>
                    <input type="text" id="edit-name" class="form-input" placeholder="Module Name">
                </div>

                <div class="form-group">
                    <label for="edit-description">Description</label>
                    <textarea id="edit-description" class="form-input" rows="3"
                        placeholder="Module description..."></textarea>
                </div>

                <div class="form-group">
                    <label for="edit-features">Features (comma separated)</label>
                    <input type="text" id="edit-features" class="form-input"
                        placeholder="Feature 1, Feature 2, Feature 3">
                </div>

                <div class="modal-actions">
                    <button class="btn btn-secondary" onclick="closeEditModal()">Cancel</button>
                    <button class="btn btn-primary" id="save-edit-btn" onclick="saveModuleEdit()">üíæ Save</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Export Options Modal -->
    <div id="export-modal" class="modal-overlay" style="display: none;">
        <div class="modal-content modal-small">
            <div class="modal-header">
                <h3>üì§ Export Module</h3>
                <button class="modal-close" onclick="closeExportModal()">√ó</button>
            </div>
            <div class="modal-body">
                <input type="hidden" id="export-module-id">
                <p class="export-description">Choose what to include in the export:</p>

                <div class="checkbox-group">
                    <label class="checkbox-label">
                        <input type="checkbox" id="export-include-runs">
                        <span class="checkbox-text">Include saved runs</span>
                        <span class="checkbox-hint">Simulation data and results</span>
                    </label>
                </div>

                <div class="checkbox-group">
                    <label class="checkbox-label">
                        <input type="checkbox" id="export-include-meshes">
                        <span class="checkbox-text">Include mesh library</span>
                        <span class="checkbox-hint">Uploaded and converted meshes</span>
                    </label>
                </div>

                <div class="modal-actions">
                    <button class="btn btn-secondary" onclick="closeExportModal()">Cancel</button>
                    <button class="btn btn-primary" onclick="confirmExport()">üì§ Export</button>
                </div>
            </div>
        </div>
    </div>

    <script src="/static/landing/js/status.js"></script>
    <script src="/static/landing/js/cases.js"></script>
</body>

</html>